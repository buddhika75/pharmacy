<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core">

    <head>
    </head>

    <body>
        <ui:composition template="./resources/template/template.xhtml">
            <ui:define name="content">

                <h:panelGroup rendered="#{!(webUserController.hasPrivilege('LabAutherizing') eq true or webUserController.hasPrivilege('LabDataentry') eq true or webUserController.hasPrivilege('LabPrinting') eq true)}" >
                    You are NOT authorized
                </h:panelGroup>

                <h:form id="form">


                    <h:panelGroup rendered="#{webUserController.hasPrivilege('LabAutherizing') eq true or webUserController.hasPrivilege('LabDataentry') eq true or webUserController.hasPrivilege('LabPrinting') eq true   }" styleClass="nonPrintBlock">
                        <p:growl id="messages" showDetail="true"/> 
                        <p:panel  >
                            <f:facet name="header" >
                                <h:panelGrid columns="6" >
                                    <p:commandButton rendered="#{webUserController.hasPrivilege('LabDataentry') eq true and patientReportController.currentPatientReport.approved ne true}"  value="Save" action="#{patientReportController.savePatientReport()}" ajax="false" >
                                    </p:commandButton>
                                    <p:commandButton ajax="false" styleClass="nonPrintBlock"  value="Calculate" action="#{patientReportController.calculate}"  >
                                    </p:commandButton>
                                    <p:commandButton styleClass="nonPrintBlock"  id="btnApprove"  disabled ="#{!(webUserController.hasPrivilege('LabAutherizing') eq true and patientReportController.currentPatientReport.dataEntered eq true )}"   value="Approve" action="#{patientReportController.approvePatientReport()}" ajax="false" >
                                    </p:commandButton>
                                    <p:commandButton styleClass="nonPrintBlock"  ajax="false" value="Print" onclick="window.print();" actionListener="#{patientReportController.printPatientReport()}" />
                                    
                                    <p:separator></p:separator>
                                    
                                    <p:commandButton  styleClass="nonPrintBlock"  value="Patient Report Search" action="#{patientReportController.patientReportSearch}" ajax="false" >
                                    </p:commandButton>
                                    <p:commandButton  styleClass="nonPrintBlock"  value="Report Search" action="lab_search_for_reporting" ajax="false" >
                                    </p:commandButton>
                                    
                                </h:panelGrid>
                            </f:facet>

                            <h:panelGrid columns="3" styleClass="alignTop" >

                                <p:panel header="Patient Details" styleClass="alignTop" >
                                    <p:panelGrid columns="2" >
                                        <h:outputLabel value="Name" ></h:outputLabel>
                                        <h:outputLabel value="#{patientReportController.currentPatientReport.patientInvestigation.patient.person.nameWithTitle}" ></h:outputLabel>
                                        <h:outputLabel value="Age" ></h:outputLabel>
                                        <h:outputLabel value="#{patientReportController.currentPatientReport.patientInvestigation.patient.age}" ></h:outputLabel>
                                        <h:outputLabel value="Sex" ></h:outputLabel>
                                        <h:outputLabel value="#{patientReportController.currentPatientReport.patientInvestigation.patient.person.sex}" ></h:outputLabel>
                                        <h:outputLabel value="Investigation" ></h:outputLabel>
                                        <h:outputLabel value="#{patientReportController.currentPatientReport.item.name}" ></h:outputLabel>
                                    </p:panelGrid>
                                </p:panel>

                                <p:panel header="Values"  rendered="#{patientReportController.currentPatientReport.patientInvestigation.investigation.reportType ne 'Microbiology'}" >
                                    <p:dataTable id="tblVals" value="#{patientReportController.currentPatientReport.patientReportItemOfValueType}"  var="pv"  >
                                        <p:column >
                                            <h:outputLabel value="#{pv.investigationItem.name}" rendered="#{pv.investigationItem.ixItemType eq 'Value'}"></h:outputLabel>
                                        </p:column>
                                        <p:column >
                                            <h:panelGroup rendered="#{pv.investigationItem.ixItemType eq 'Value'}">

                                                <h:panelGroup rendered="#{empty pv.investigationItem.investigationItemValues}" >

                                                    <h:panelGroup rendered="#{pv.investigationItem.ixItemValueType eq 'Varchar'}" > 
                                                        <p:inputText  id="txtStrVal" autocomplete="off"  value="#{patientReportController.strEnterVal}"  style="min-width: 300px;" >
                                                            <f:ajax event="blur"  execute="txtStrVal" listener="#{patientReportController.saveStrVal(pv.id) }" ></f:ajax>
                                                        </p:inputText>
                                                        <p:watermark  value="#{pv.strValue}" for="txtStrVal" />
                                                    </h:panelGroup>



                                                    <h:panelGroup rendered="#{pv.investigationItem.ixItemValueType eq 'Double'}"  >
                                                        <p:inputText id="txtDblVal" autocomplete="off"  value="#{patientReportController.dblEnterVal}"   style="min-width: 200px;">
                                                            <f:ajax event="blur"  execute="@this" listener="#{patientReportController.saveDblVal(pv.id)}" ></f:ajax>
                                                        </p:inputText>
                                                        <p:watermark  value="#{pv.doubleValue}" for="txtDblVal" />
                                                    </h:panelGroup>

                                                    <h:panelGroup rendered="#{pv.investigationItem.ixItemValueType eq 'Memo'}" >
                                                        <h:panelGroup rendered="#{empty pv.investigationItem.investigationItemValues}" >
                                                            <p:inputTextarea id="txtMemoVal"   value="#{patientReportController.memoEnterVal}"   style="min-width: 200px;" >
                                                                <f:ajax event="blur"  execute="@this" listener="#{patientReportController.saveMemoVal(pv.id)}" ></f:ajax>
                                                            </p:inputTextarea>
                                                            <p:watermark  value="#{pv.lobValue}" for="txtMemoVal" />
                                                        </h:panelGroup>
                                                    </h:panelGroup>


                                                </h:panelGroup>

                                                <h:panelGroup rendered="#{!empty pv.investigationItem.investigationItemValues}" >

                                                    <h:panelGroup rendered="#{pv.investigationItem.ixItemValueType eq 'Varchar'}">
                                                        <p:selectOneMenu id="cmbStrVal" value="#{patientReportController.strEnterVal}" editable="true"  style="min-width: 300px!important;" >
                                                            <f:selectItems value="#{pv.investigationItem.investigationItemValues}" var="iiv" itemLabel="#{iiv.name}" itemValue="#{iiv.name}" ></f:selectItems>
                                                            <f:ajax event="change"  execute="@this" listener="#{patientReportController.saveStrVal(pv.id) }" ></f:ajax>
                                                        </p:selectOneMenu>
                                                        <p:watermark  value="#{pv.strValue}" for="cmbStrVal" />
                                                    </h:panelGroup>

                                                </h:panelGroup>

                                            </h:panelGroup>






                                        </p:column>
                                    </p:dataTable>
                                </p:panel>
                                <h:panelGroup  rendered="#{patientReportController.currentPatientReport.patientInvestigation.investigation.reportType ne 'Microbiology'}" >
                                    <p:panel header="Calculations" >
                                        <p:dataTable emptyMessage="No Calculations"  value="#{patientReportController.currentPatientReport.patientReportItemOfCalculationType}"  var="pvc"  >
                                            <p:column >
                                                <h:outputLabel value="#{pvc.investigationItem.name}" ></h:outputLabel>
                                            </p:column>
                                            <p:column >
                                                <h:panelGroup rendered="#{pvc.investigationItem.ixItemValueType eq 'Varchar'}" style="width: 200px;">
                                                    <p:inputText id="txtStrCal" value="#{patientReportController.strEnterVal}" >
                                                        <f:ajax event="blur"  execute="@this" listener="#{patientReportController.saveStrVal(pvc.id) }" ></f:ajax>
                                                    </p:inputText>
                                                    <p:watermark  value="#{pvc.strValue}" for="txtStrCal" />
                                                </h:panelGroup>
                                                <h:panelGroup rendered="#{pvc.investigationItem.ixItemValueType eq 'Double'}" style="width: 200px;">
                                                    <p:inputText id="txtDblCal" value="#{patientReportController.dblEnterVal}" >
                                                        <f:ajax event="blur"  execute="@this" listener="#{patientReportController.saveDblVal(pvc.id) }" ></f:ajax>
                                                    </p:inputText>
                                                    <p:watermark  value="#{pvc.doubleValue}" for="txtDblCal" >
                                                    </p:watermark>
                                                </h:panelGroup>
                                            </p:column>
                                        </p:dataTable>
                                    </p:panel>
                                    <p:panel header="Flags" >
                                        <p:dataTable emptyMessage="No Flags" value="#{patientReportController.currentPatientReport.patientReportItemOfFlagType}"  var="pvf" >
                                            <p:column >
                                                <h:outputLabel value="#{pvf.investigationItem.name}" ></h:outputLabel>
                                            </p:column>
                                            <p:column >
                                                <p:selectOneMenu id="cmbStrFlag" value="#{patientReportController.strEnterVal}" editable="true" style="min-width: 200px;" >
                                                    <f:selectItems value="#{testFlagController.getIxItemFlags(pvf.investigationItem)}" var="iivfh" itemLabel="#{iivfh.highMessage}" itemValue="#{iivfh}" ></f:selectItems>
                                                    <f:selectItems value="#{testFlagController.getIxItemFlags(pvf.investigationItem)}" var="iivfl" itemLabel="#{iivfl.lowMessage}" itemValue="#{iivfl}" ></f:selectItems>
                                                    <f:selectItems value="#{testFlagController.getIxItemFlags(pvf.investigationItem)}" var="iivf" itemLabel="#{iivf.normalMessage}" itemValue="#{iivf}" ></f:selectItems>
                                                    <f:ajax event="change"  execute="@this" listener="#{patientReportController.saveStrVal(pvf.id) }" ></f:ajax>
                                                </p:selectOneMenu>
                                                <p:watermark  value="#{pvf.strValue}" for="cmbStrFlag" />
                                            </p:column>
                                        </p:dataTable>
                                    </p:panel>

                                    <p:panel header="Dynamic Labels" >
                                        <p:dataTable emptyMessage="No Dynamic Labels" value="#{patientReportController.currentPatientReport.patientReportItemOfDynamicLabelType}"  var="pvd">
                                            <p:column >
                                                <h:outputLabel value="#{pvd.investigationItem.name}" ></h:outputLabel>
                                            </p:column>
                                            <p:column >
                                                <p:selectOneMenu  id="cmbStrDl" value="#{patientReportController.strEnterVal}" editable="true" style="min-width: 200px;" >
                                                    <f:selectItems value="#{investigationItemDynamicLabelController.getDynamicLabelsByIxItId(pvd.investigationItem) }" var="iivd" itemLabel="#{iivd.flagMessage}" itemValue="#{iivd}" ></f:selectItems>
                                                    <f:ajax event="change"  execute="@this" listener="#{patientReportController.saveStrVal(pvd.id) }" ></f:ajax>
                                                </p:selectOneMenu>
                                                <p:watermark  value="#{pvd.strValue}" for="cmbStrDl" />
                                            </p:column>
                                        </p:dataTable>
                                    </p:panel>
                                </h:panelGroup>

                                <p:panel header="Microbiology"    rendered="#{patientReportController.currentPatientReport.patientInvestigation.investigation.reportType eq 'Microbiology'}" >

                                    <f:view contentType="text/html">

                                        <p:dataTable id="tblMicVals" value="#{patientReportController.currentPatientReport.patientReportItemOfValueType}"  var="pv"  >

                                            <p:column >
                                                <h:outputLabel value="#{pv.investigationItem.name}" rendered="#{pv.investigationItem.ixItemType eq 'Value'}"></h:outputLabel>
                                            </p:column>

                                            <p:column >
                                                <h:panelGroup rendered="#{pv.investigationItem.ixItemType eq 'Value'}">
                                                    <h:panelGroup rendered="#{pv.investigationItem.ixItemValueType eq 'Memo'}" >
                                                        <p:inputTextarea id="txtMicMemoVal"   minQueryLength="1"  style="min-width: 200px;" completeMethod="#{investigationItemValueController.completeValues}" value="#{patientReportController.memoEnterVal}" >
                                                            <f:ajax event="itemSelect"  execute="@this" listener="#{patientReportController.saveMemoVal(pv.id) }" ></f:ajax>
                                                        </p:inputTextarea>
                                                        <p:watermark  value="#{pv.lobValue}" for="txtMicMemoVal" />
                                                    </h:panelGroup>
                                                    <h:panelGroup rendered="#{pv.investigationItem.ixItemValueType eq 'Varchar'}">
                                                        <p:selectOneMenu id="cmbMicStrVal" value="#{patientReportController.strEnterVal}" editable="true"  style="min-width: 300px!important;" >
                                                            <f:selectItem itemLabel="SENSITIVE" itemValue="SENSITIVE" ></f:selectItem>
                                                            <f:selectItem itemLabel="Resistant" itemValue="Resistant" ></f:selectItem>
                                                            <f:selectItem itemLabel="Intermediate" itemValue="Intermediate" ></f:selectItem>
                                                            <f:ajax event="change"  execute="@this" listener="#{patientReportController.saveStrVal(pv.id) }" ></f:ajax>
                                                        </p:selectOneMenu>
                                                        <p:watermark  value="#{pv.strValue}" for="cmbMicStrVal" />
                                                    </h:panelGroup>


                                                </h:panelGroup>






                                            </p:column>
                                        </p:dataTable>

                                    </f:view>

                                </p:panel>


                            </h:panelGrid>


                        </p:panel>



                    </h:panelGroup>



                    <p:commandButton styleClass="nonPrintBlock"  ajax="false" value="Print" onclick="window.print();" actionListener="#{patientReportController.printPatientReport()}" />




                    <p:panel styleClass="myDivToPrint" id="divPrint" style="border: 0px; margin: 0px; padding: 0px;" >



                        <h:panelGroup rendered="#{patientReportController.currentPatientReport.patientInvestigation.investigation.reportType ne 'Microbiology'}"  >
                            <div id="divReport"  style="min-width:800px;min-height: 1100px; position: relative; font-size: 150%;">


                                <ui:repeat value="#{commonReportItemController.items}" var="myCli" >
                                    <div style="#{myCli.cssStyle}; position:absolute;">
                                        <h:outputText rendered="#{myCli.ixItemType eq 'Label' and myCli.retired ne true }"  value="#{myCli.name}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'PatientName' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.patient.person.nameWithTitle}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'PatientAge' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.patient.age}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'PatientSex' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.patient.person.sex}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'InvestigationName' and  myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.investigation.name}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'Speciman' and  myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.investigation.sample.name}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'SampledTime' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.sampledAt}" style="color: #{myCli.cssColor}" escape="false" >
                                            <f:convertDateTime pattern="hh mm a"/>
                                        </h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'BilledDate' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.billItem.bill.createdAt}" style="color: #{myCli.cssColor}" escape="false" >
                                            <f:convertDateTime pattern="dd MMMM yyyy"></f:convertDateTime>
                                        </h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'BilledTime' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.billItem.bill.createdAt}" style="color: #{myCli.cssColor}" escape="false" >
                                            <f:convertDateTime pattern="hh mm a"/>
                                        </h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'SampledDate' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.sampledAt}" style="color: #{myCli.cssColor}" escape="false" >
                                            <f:convertDateTime pattern="dd MMMM yyyy"></f:convertDateTime>
                                        </h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'BillNo' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.billItem.bill.insId}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>

                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'ReportedDate' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.dataEntryAt}" style="color: #{myCli.cssColor}" escape="false" >
                                            <f:convertDateTime pattern="dd MMMM yyyy"></f:convertDateTime>
                                        </h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'ReportedTime' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.dataEntryAt}" style="color: #{myCli.cssColor}" escape="false" >
                                            <f:convertDateTime pattern="hh mm a"/>
                                        </h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'ReferringDoctor' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.billItem.bill.referredBy.person.nameWithTitle}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>

                                        <p:graphicImage rendered="#{myCli.reportItemType eq 'AutherizedSignature' and myCli.retired eq false }"    value="#{staffImageController.signatureById}" style="width: #{myCli.cssWidth}; max-height: 50px!important;"  >
                                            <f:param name="id" value="#{patientReportController.currentPatientReport.approveUser.staff.id}" />
                                        </p:graphicImage>

                                    </div>
                                </ui:repeat>



                                <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                    <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                        <h:outputLabel value="#{prv.lobValue}" rendered="#{prv.investigationItem.ixItemType eq 'Value' and prv.investigationItem.ixItemValueType eq 'Memo' and prv.investigationItem.retired eq false}"  escape="false" />
                                    </div>
                                </ui:repeat>

                                <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                    <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                        <h:outputLabel value="#{prv.strValue}" rendered="#{prv.investigationItem.ixItemType eq 'Value' and prv.investigationItem.ixItemValueType eq 'Varchar'}" escape="false" />
                                    </div>
                                </ui:repeat>

                                <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                    <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                        <h:outputLabel value="#{prv.doubleValue}"  rendered="#{prv.investigationItem.ixItemType eq 'Value' and prv.investigationItem.ixItemValueType eq 'Double' and prv.investigationItem.retired eq false}"   escape="false" />
                                    </div>
                                </ui:repeat>


                                <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                    <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                        <h:outputLabel value="#{prv.strValue}" rendered="#{prv.investigationItem.ixItemType eq 'DynamicLabel'}" escape="false" />
                                    </div>
                                </ui:repeat>

                                <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                    <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                        <h:outputLabel value="#{prv.strValue}" rendered="#{prv.investigationItem.ixItemType eq 'Flag'}" escape="false" />
                                    </div>
                                </ui:repeat>

                                <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                    <div style="#{prv.investigationItem.cssStyle}; position:absolute;">
                                        <h:outputLabel value="#{prv.doubleValue}" rendered="#{prv.investigationItem.ixItemType eq 'Calculation' }" escape="false" >
                                            <f:convertNumber pattern="0.0" />
                                        </h:outputLabel>
                                    </div>
                                </ui:repeat>

                                <ui:repeat value="#{patientReportController.currentPatientReport.item.reportItems}" var="myIi" >
                                    <div style="#{myIi.cssStyle}; position:absolute;">
                                        <h:outputText rendered="#{myIi.retired ne true and myIi.ixItemType eq 'Label' }" value="#{myIi.name}" style="color: #{myIi.cssColor}" escape="false" ></h:outputText>
                                    </div>
                                </ui:repeat>


                            </div>
                        </h:panelGroup>


                        <h:panelGroup rendered="#{patientReportController.currentPatientReport.patientInvestigation.investigation.reportType eq 'Microbiology'}"  >
                            <div id="divReportM"  style="min-width:800px;min-height: 1100px; position: relative; font-size: 150%;">


                                <ui:repeat value="#{commonReportItemController.items}" var="myCli" >

                                    <div style="#{myCli.cssStyle}; position:absolute;">
                                        <h:outputText rendered="#{myCli.ixItemType eq 'Label' and myCli.retired ne true }"  value="#{myCli.name}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'PatientName' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.patient.person.nameWithTitle}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'PatientAge' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.patient.age}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'PatientSex' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.patient.person.sex}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'InvestigationName' and  myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.investigation.name}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'Speciman' and  myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.investigation.sample.name}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'SampledTime' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.sampledAt}" style="color: #{myCli.cssColor}" escape="false" >
                                            <f:convertDateTime pattern="hh mm a"/>
                                        </h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'BilledDate' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.billItem.bill.createdAt}" style="color: #{myCli.cssColor}" escape="false" >
                                            <f:convertDateTime pattern="dd MMMM yyyy"></f:convertDateTime>
                                        </h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'BilledTime' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.billItem.bill.createdAt}" style="color: #{myCli.cssColor}" escape="false" >
                                            <f:convertDateTime pattern="hh mm a"/>
                                        </h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'SampledDate' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.sampledAt}" style="color: #{myCli.cssColor}" escape="false" >
                                            <f:convertDateTime pattern="dd MMMM yyyy"></f:convertDateTime>
                                        </h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'BillNo' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.billItem.bill.insId}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>

                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'ReportedDate' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.dataEntryAt}" style="color: #{myCli.cssColor}" escape="false" >
                                            <f:convertDateTime pattern="dd MMMM yyyy"></f:convertDateTime>
                                        </h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'ReportedTime' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.dataEntryAt}" style="color: #{myCli.cssColor}" escape="false" >
                                            <f:convertDateTime pattern="hh mm a"/>
                                        </h:outputText>
                                        <h:outputText rendered="#{myCli.ixItemType ne 'Label' and myCli.reportItemType eq 'ReferringDoctor' and myCli.retired eq false }"  value="#{patientReportController.currentPatientReport.patientInvestigation.billItem.bill.referredBy.person.nameWithTitle}" style="color: #{myCli.cssColor}" escape="false" ></h:outputText>

                                        <h:panelGroup rendered="#{patientReportController.currentPatientReport.approveUser.staff.baImage ne null}">
                                            <p:graphicImage rendered="#{myCli.reportItemType eq 'AutherizedSignature' and myCli.retired eq false }"    value="#{staffImageController.signatureById}" style="width: #{myCli.cssWidth}; max-height: 50px!important;"  >
                                                <f:param name="id" value="#{patientReportController.currentPatientReport.approveUser.staff.id}" />
                                            </p:graphicImage>
                                            
                                            
                                        </h:panelGroup>

                                    </div>
                                </ui:repeat>

                                <table id="micro" style="position: absolute; top: 38%; left:10%; font-size: 12px!important;" >
                                    <tr>
                                        <td id="micromemos">
                                            <table  style="width: 100%!important;">                 
                                                <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                                    <h:panelGroup rendered="#{prv.investigationItem.ixItemType eq 'Value' and prv.investigationItem.ixItemValueType eq 'Memo' and prv.investigationItem.retired eq false and prv.lobValue ne '' and prv.lobValue ne null and prv.investigationItem.transCssTop  lt 50 }" >
                                                        <tr>
                                                            <td style="min-width: 300px;padding: 5px;padding-left: 1px; padding-right: 1px;">
                                                                <h:outputLabel value="#{prv.investigationItem.name}"  escape="false" />
                                                            </td>
                                                            <td  style="padding: 5px;margin-left: 90px;">
                                                                <h:outputLabel value="#{prv.lobValue}"  escape="false" />
                                                            </td>
                                                        </tr>
                                                    </h:panelGroup>
                                                </ui:repeat>
                                            </table>
                                        </td>
                                    </tr>
                                    <br/><br/>
                                    <tr>
                                        <td id="ablist">
                                            <table>
                                                <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                                    <h:panelGroup rendered="#{prv.investigationItem.ixItemType eq 'Value' and prv.investigationItem.ixItemValueType eq 'Varchar' and prv.investigationItem.retired eq false and prv.strValue ne '' and prv.strValue ne null  }" >
                                                        <tr>
                                                            <td style="min-width: 300px;padding: 1px;">
                                                                <h:outputLabel value="#{prv.investigationItem.name}"  escape="false" />
                                                            </td>
                                                            <td>
                                                                <h:outputLabel value="#{prv.strValue}" escape="false" />
                                                            </td>
                                                        </tr>
                                                    </h:panelGroup>
                                                </ui:repeat>
                                            </table>

                                        </td>
                                    </tr>
                                    <br/><br/>
                                    <tr>
                                        <td id="miccomments">
                                            <table>
                                                <ui:repeat  value="#{patientReportController.currentPatientReport.patientReportItemValues}" var="prv" >
                                                    <h:panelGroup rendered="#{prv.investigationItem.ixItemType eq 'Value' and prv.investigationItem.ixItemValueType eq 'Memo' and prv.investigationItem.retired eq false and prv.lobValue ne '' and prv.lobValue ne null and prv.investigationItem.transCssTop gt 50 }" >

                                                        <tr>
                                                            <td style="min-width: 300px;padding: 5px;padding-left: 1px; padding-right: 1px;">
                                                                <h:outputLabel value="#{prv.investigationItem.name}"  escape="false" />
                                                            </td>
                                                            <td>
                                                                <h:outputLabel value="#{prv.lobValue}"  escape="false" />
                                                            </td>
                                                        </tr>

                                                    </h:panelGroup>

                                                </ui:repeat>
                                            </table>

                                        </td>
                                    </tr>

                                </table>


                            </div>
                        </h:panelGroup>




                    </p:panel>


                </h:form>


            </ui:define>



        </ui:composition>

    </body>
</html>
